<div class="mt-6 opacity-80 text-sm">
  <span>Views: <span id="post-view-count">â€¦</span></span>
</div>
<script>
(function () {
  // Per-post key (stable if you change domain)
  var ns = "kiwigpt.co.nz";
  var key = "{{ .RelPermalink }}"; // e.g. /posts/my-article/

  // (Optional) basic de-dupe: 1 hit per browser per hour
  var stamp = new Date().toISOString().slice(0,13); // YYYY-MM-DDTHH
  var seen = "pv:" + key + ":" + stamp;
  try {
    if (localStorage.getItem(seen)) {
      // Already counted this hour: just read the value
      fetch("https://api.countapi.xyz/get/" + encodeURIComponent(ns) + "/" + encodeURIComponent(key))
        .then(r => r.json())
        .then(d => { if (d && typeof d.value === "number") document.getElementById("post-view-count").textContent = d.value; })
        .catch(()=>{});
      return;
    }
  } catch(_) {}

  // Increment and display
  fetch("https://api.countapi.xyz/hit/" + encodeURIComponent(ns) + "/" + encodeURIComponent(key))
    .then(r => r.json())
    .then(d => {
      if (d && typeof d.value === "number") {
        document.getElementById("post-view-count").textContent = d.value;
        try { localStorage.setItem(seen, "1"); } catch(_) {}
      }
    })
    .catch(()=>{});
})();
</script>