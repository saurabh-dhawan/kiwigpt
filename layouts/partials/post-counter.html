{{/* Reusable per-post counter using CountAPI (JSONP) */}}
<div class="mt-6 opacity-80 text-sm">
  <span>Views: <span id="post-view-count">â€¦</span></span>
</div>
<script>
(function () {
  var ns  = "kiwigpt.co.nz";
  var key = "{{ .RelPermalink }}"; // stable per post, domain-agnostic
  var el  = document.getElementById("post-view-count");
  if (!el) return;

  // JSONP callback to avoid CORS/adblock fetch issues
  var cb = "capi_" + Math.random().toString(36).slice(2);
  window[cb] = function (d) {
    if (d && typeof d.value === "number") el.textContent = d.value;
    cleanup();
  };

  function cleanup() {
    try { delete window[cb]; } catch(_) {}
    if (script && script.parentNode) script.parentNode.removeChild(script);
  }

  var script = document.createElement("script");
  script.src = "https://api.countapi.xyz/hit/"
             + encodeURIComponent(ns) + "/"
             + encodeURIComponent(key)
             + "?callback=" + cb;
  script.onerror = function () {
    // Fallback to fetch if JSONP is blocked for some reason
    try {
      fetch("https://api.countapi.xyz/hit/"
            + encodeURIComponent(ns) + "/"
            + encodeURIComponent(key))
        .then(function(r){return r.json();})
        .then(function(d){ if (d && typeof d.value === "number") el.textContent = d.value; });
    } catch(_) {}
  };
  document.head.appendChild(script);
})();
</script>